<!-- VERSION 3 START -->
{% extends "base.html" %}
{% block content %}

<!-- Page header: title + short description + quick actions -->
<div class="row space-between" style="align-items:flex-end; gap:16px; margin-bottom:12px">
  <div>
    <h2 style="margin:0 0 6px">My Events</h2> <!-- Page title -->
    <p class="muted" style="margin:0">
      Events published by {{ org.organisation_name or "your organiser account" }}. <!-- Shows organiser name -->
    </p>
  </div>
  <!-- Action buttons -->
  <div class="row" style="gap:10px">
    <a class="btn outline" href="{{ url_for('main.event_new') }}">Create new event</a> <!-- Go to create event -->
    <a class="btn" href="{{ url_for('main.events_list') }}">View public events</a> <!-- Go to public listing -->
  </div>
</div>

{% if events %} <!-- If the organiser has events, show the grid -->
  <div class="events-grid"> <!-- Responsive grid container -->
    {% for ev in events %} <!-- Loop through the organiser's events -->
      <div class="card event-card" style="position:relative"> <!-- Event card container -->
        <div class="event-media"></div> <!-- Decorative banner area -->
        <div class="event-body"> <!-- Main card content -->

          <!-- Title + price badge -->
          <div class="row space-between" style="align-items:flex-start">
            <h3 class="event-title" style="margin:0">{{ ev.title }}</h3> <!-- Event title -->
            <span class="badge" style="font-weight:700">
              €{{ '%.2f' % (ev.ticket_price_cents/100) }} <!-- Ticket price -->
            </span>
          </div>

          <!-- Date/time + venue -->
          <div class="event-meta">
            {{ ev.starts_at.strftime('%Y-%m-%d %H:%M') }} • {{ ev.venue or 'TBA' }} <!-- Event schedule -->
          </div>

          <!-- VERSION 4 START -->
          <!-- Row showing publication and completion status, plus action button -->
          <div class="row space-between" style="gap:10px; margin-top:10px; align-items:center">
          <!-- Status badges -->
          <div class="row" style="gap:8px; margin-top:10px; align-items:center">
            <!-- Published vs draft status -->
            {% if ev.published %}
              <span class="badge verified">Published</span> <!-- Visible to public -->
            {% else %}
              <span class="badge">Draft</span> <!-- Not public yet -->
            {% endif %}

            <!-- Completion status -->
            {% if ev.is_completed %}
              <span class="badge" style="background:#E2E8F0; color:#0F172A; font-weight:700;">Completed</span> <!-- Event has finished -->
            {% else %}
              <span class="badge" style="background:#DCFCE7; color:#166534; font-weight:700;">Active</span> <!-- Event is still ongoing -->
            {% endif %}
            </div>

            <!-- Action button to toggle completion state -->
            <div>
              {% if ev.is_completed %}
                <!-- Allow organiser to reopen the event -->
                <form method="post" action="{{ url_for('main.organiser_event_complete', event_id=ev.id) }}" style="display:inline;">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="complete" value="0">
                  <button class="btn outline" type="submit">Mark as not completed</button>
                </form>
              {% else %}
                <!-- Allow organiser to mark the event as completed -->
                <form method="post" action="{{ url_for('main.organiser_event_complete', event_id=ev.id) }}" style="display:inline;">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="complete" value="1">
                  <button class="btn" type="submit">Mark as completed</button>
                </form>
              {% endif %}
            </div>
          </div>
          <!-- VERSION 4 END -->

          <!-- Card actions -->
          <div class="event-actions" style="margin-top:12px">
            <a class="btn" href="{{ url_for('main.event_detail', event_id=ev.id) }}">View</a> <!-- View event page -->
            <a class="btn outline" href="{{ url_for('main.organiser_event_edit', event_id=ev.id) }}">Edit</a> <!-- Edit form -->
            <a class="btn primary" href="{{ url_for('main.organiser_event_analytics', event_id=ev.id) }}">Analytics</a> <!-- Analytics page -->
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

{% else %} <!-- If no events exist, show an empty state -->
  <div class="card">
    <p class="muted" style="margin:0">You haven’t created any events yet.</p> <!-- Empty message -->
    <div style="margin-top:12px">
      <a class="btn primary" href="{{ url_for('main.event_new') }}">Create your first event</a> <!-- CTA to create -->
    </div>
  </div>
{% endif %}

{% endblock %}
<!-- VERSION 3 END -->